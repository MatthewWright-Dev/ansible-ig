---
  - hosts: localhost
    gather_facts: no
    tasks:
      - name: PY Public ACL
        ec2_vpc_nacl:
          vpc_id:  "{{ vpc.vpc.id }}"
          name: PY-Pub-ACL
          region: us-west-1
          subnets: ["{{ pub_sub_1.subnet.id }}"]
          tags:
            Name: PY Public
          ingress:
              # rule no, protocol, allow/deny, cidr, icmp_type, icmp_code,
              #                                             port from, port to
              
              - [100, 'tcp', 'allow', '0.0.0.0/0', null, null, 22, 22]
              - [110, 'tcp', 'allow', '107.185.158.130/32', null, null, 80, 80]
              - [120, 'tcp', 'allow', '107.185.158.130/32', null, null, 443, 443]
              - [900, 'tcp', 'allow', '0.0.0.0/0', null, null, 1024, 65535]
              - [999, 'all', 'deny', '0.0.0.0/0', null, null, 0, 65535]

          egress:
              - [100, 'tcp', 'allow', '0.0.0.0/0', null, null, 22, 22]
              - [110, 'tcp', 'allow', '0.0.0.0/0', null, null, 80, 80]
              - [120, 'tcp', 'allow', '0.0.0.0/0', null, null, 443, 443]
              - [900, 'tcp', 'allow', '0.0.0.0/0', null, null, 1024, 65535]
              - [999, 'all', 'deny', '0.0.0.0/0', null, null, 0, 65535]
          state: 'present'
      - name: PY Private ACL
        ec2_vpc_nacl:
          vpc_id:  "{{ vpc.vpc.id }}"
          name: PY-Priv-ACL
          region: us-west-1
          subnets: ["{{ priv_sub_1.subnet.id }}", "{{ priv_sub_2.subnet.id }}"]
          tags:
            Name: PY Private
          ingress:
              # rule no, protocol, allow/deny, cidr, icmp_type, icmp_code,
              #                                             port from, port to
              
              - [100, 'tcp', 'allow', '10.10.0.0/16', null, null, 5432, 5432]
              - [110, 'tcp', 'allow', '10.10.0.0/16', null, null, 443, 443]
              - [120, 'tcp', 'allow', '10.10.0.0/16', null, null, 8080, 8080]
              - [999, 'all', 'deny', '0.0.0.0/0', null, null, 0, 65535]

          egress:
              - [100, 'tcp', 'allow', '0.0.0.0/0', null, null, 1024, 65535]
              - [999, 'all', 'deny', '0.0.0.0/0', null, null, 0, 65535]
          state: 'present'